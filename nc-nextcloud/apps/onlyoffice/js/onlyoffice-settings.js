!function(e,o){e(document).ready((function(){OCA.Onlyoffice=_.extend({},OCA.Onlyoffice),OCA.Onlyoffice.AppName||(OCA.Onlyoffice={AppName:"onlyoffice"});var c=function(){e("#onlyofficeSecretPanel").toggleClass("onlyoffice-hide"),e("#onlyofficeAdv .icon").toggleClass("icon-triangle-s icon-triangle-n")};(e("#onlyofficeInternalUrl").val().length||e("#onlyofficeStorageUrl").val().length||e("#onlyofficeJwtHeader").val().length)&&c(),e("#onlyofficeAdv").click(c),e("#onlyofficeGroups").prop("checked",""!=e("#onlyofficeLimitGroups").val());var i=function(){e("#onlyofficeGroups").prop("checked")?o.Settings.setupGroupsSelect(e("#onlyofficeLimitGroups")):e("#onlyofficeLimitGroups").select2("destroy")};e("#onlyofficeGroups").click(i),i();var n=function(){e("#onlyofficeAddrSettings input:not(#onlyofficeStorageUrl)").prop("disabled",e("#onlyofficeDemo").prop("checked"))};e("#onlyofficeDemo").click(n),n(),e("#onlyofficeWatermark_enabled").click((function(){e("#onlyofficeWatermarkSettings").toggleClass("onlyoffice-hide",!e("#onlyofficeWatermark_enabled").prop("checked"))})),e("#onlyofficeWatermark_shareAll").click((function(){e("#onlyofficeWatermark_shareRead").parent().toggleClass("onlyoffice-hide")})),e("#onlyofficeWatermark_linkAll").click((function(){e("#onlyofficeWatermark_link_sensitive").toggleClass("onlyoffice-hide")}));var l=["allGroups"],a=["allTags","linkTags"],f=function(c){var i=function(){e("#onlyofficeWatermark_"+c).prop("checked")?c.indexOf("Group")>=0?o.Settings.setupGroupsSelect(e("#onlyofficeWatermark_"+c+"List")):e("#onlyofficeWatermark_"+c+"List").select2({allowClear:!0,closeOnSelect:!1,multiple:!0,separator:"|",toggleSelect:!0,placeholder:t(OCA.Onlyoffice.AppName,"Select tag"),query:_.debounce((function(e){e.callback({results:o.SystemTags.collection.filterByName(e.term)})}),100,!0),initSelection:function(c,t){t((e(c).val()||[]).split("|").map((function(e){return o.SystemTags.collection.get(e)})))},formatResult:function(e){return o.SystemTags.getDescriptiveTag(e)},formatSelection:function(e){return e.get("name")},sortResults:function(e){return e.sort((function(e,c){return o.Util.naturalSortCompare(e.get("name"),c.get("name"))})),e}}):e("#onlyofficeWatermark_"+c+"List").select2("destroy")};e("#onlyofficeWatermark_"+c).click(i),i()};e.each(l,(function(e,o){f(o)})),o.SystemTags&&o.SystemTags.collection&&o.SystemTags.collection.fetch({success:function(){e.each(a,(function(e,o){f(o)}))}}),e("#onlyofficeAddrSave").click((function(){e(".section-onlyoffice").addClass("icon-loading");var c=e("#onlyofficeUrl").val().trim();c.length||e("#onlyofficeInternalUrl, #onlyofficeStorageUrl, #onlyofficeSecret, #onlyofficeJwtHeader").val("");var i=(e("#onlyofficeInternalUrl:visible").val()||"").trim(),n=(e("#onlyofficeStorageUrl:visible").val()||"").trim(),l=e("#onlyofficeVerifyPeerOff").prop("checked"),a=(e("#onlyofficeSecret:visible").val()||"").trim(),f=(e("#onlyofficeJwtHeader:visible").val()||"").trim(),r=e("#onlyofficeDemo").prop("checked");e.ajax({method:"PUT",url:o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/ajax/settings/address"),data:{documentserver:c,documentserverInternal:i,storageUrl:n,verifyPeerOff:l,secret:a,jwtHeader:f,demo:r},success:function(o){if(e(".section-onlyoffice").removeClass("icon-loading"),o&&(null!=o.documentserver||r)){e("#onlyofficeUrl").val(o.documentserver),e("#onlyofficeInternalUrl").val(o.documentserverInternal),e("#onlyofficeStorageUrl").val(o.storageUrl),e("#onlyofficeSecret").val(o.secret),e("#onlyofficeJwtHeader").val(o.jwtHeader),e(".section-onlyoffice-common, .section-onlyoffice-templates, .section-onlyoffice-watermark").toggleClass("onlyoffice-hide",null==o.documentserver&&!r||!!o.error.length);var c=o.version?" ("+t(OCA.Onlyoffice.AppName,"version")+" "+o.version+")":"";o.error?OCP.Toast.error(t(OCA.Onlyoffice.AppName,"Error when trying to connect")+" ("+o.error+")"+c):OCP.Toast.success(t(OCA.Onlyoffice.AppName,"Settings have been successfully updated")+c)}else e(".section-onlyoffice-common, .section-onlyoffice-templates, .section-onlyoffice-watermark").addClass("onlyoffice-hide")}})})),e("#onlyofficeSave").click((function(){e(".section-onlyoffice").addClass("icon-loading");var c={};e('input[id^="onlyofficeDefFormat"]').each((function(){c[this.name]=this.checked}));var i={};e('input[id^="onlyofficeEditFormat"]').each((function(){i[this.name]=this.checked}));var n=e("#onlyofficeSameTab").is(":checked"),l=e("#onlyofficePreview").is(":checked"),a=e("#onlyofficeAdvanced").is(":checked"),f=e("#onlyofficeCronChecker").is(":checked"),r=e("#onlyofficeVersionHistory").is(":checked"),s=e("#onlyofficeGroups").prop("checked")?e("#onlyofficeLimitGroups").val():"",y=s?s.split("|"):[],d=e("#onlyofficeChat").is(":checked"),p=e("#onlyofficeCompactHeader").is(":checked"),m=e("#onlyofficeFeedback").is(":checked"),u=e("#onlyofficeForcesave").is(":checked"),h=e("#onlyofficeHelp").is(":checked"),g=e("#onlyofficeToolbarNoTabs").is(":checked"),k=e("input[type='radio'][name='reviewDisplay']:checked").attr("id").replace("onlyofficeReviewDisplay_",""),v=e("input[type='radio'][name='theme']:checked").attr("id").replace("onlyofficeTheme_","");e.ajax({method:"PUT",url:o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/ajax/settings/common"),data:{defFormats:c,editFormats:i,sameTab:n,preview:l,advanced:a,cronChecker:f,versionHistory:r,limitGroups:y,chat:d,compactHeader:p,feedback:m,forcesave:u,help:h,toolbarNoTabs:g,reviewDisplay:k,theme:v},success:function(o){e(".section-onlyoffice").removeClass("icon-loading"),o&&OCP.Toast.success(t(OCA.Onlyoffice.AppName,"Settings have been successfully updated"))}})})),e("#onlyofficeSecuritySave").click((function(){e(".section-onlyoffice").addClass("icon-loading");var c=e("#onlyofficePlugins").is(":checked"),i=e("#onlyofficeMacros").is(":checked"),n=e("input[type='radio'][name='protection']:checked").attr("id").replace("onlyofficeProtection_",""),f={enabled:e("#onlyofficeWatermark_enabled").is(":checked")};f.enabled&&(f.text=(e("#onlyofficeWatermark_text").val()||"").trim(),e.each(["allGroups","allTags","linkAll","linkRead","linkSecure","linkTags","shareAll","shareRead"],(function(o,c){f[c]=e("#onlyofficeWatermark_"+c).is(":checked")})),e.each(l.concat(a),(function(o,c){var t=e("#onlyofficeWatermark_"+c).is(":checked")?e("#onlyofficeWatermark_"+c+"List").val():"";f[c+"List"]=t?t.split("|"):[]}))),e.ajax({method:"PUT",url:o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/ajax/settings/security"),data:{watermarks:f,plugins:c,macros:i,protection:n},success:function(o){e(".section-onlyoffice").removeClass("icon-loading"),o&&OCP.Toast.success(t(OCA.Onlyoffice.AppName,"Settings have been successfully updated"))}})})),e(".section-onlyoffice-addr input").keypress((function(o){13===(o.keyCode||o.which)&&e("#onlyofficeAddrSave").click()})),e("#onlyofficeSecret-show").click((function(){"password"==e("#onlyofficeSecret").attr("type")?e("#onlyofficeSecret").attr("type","text"):e("#onlyofficeSecret").attr("type","password")})),e("#onlyofficeClearVersionHistory").click((function(){e(".section-onlyoffice").addClass("icon-loading"),e.ajax({method:"DELETE",url:o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/ajax/settings/history"),success:function(o){e(".section-onlyoffice").removeClass("icon-loading"),o&&OCP.Toast.success(t(OCA.Onlyoffice.AppName,"All history successfully deleted"))}})})),e("#onlyofficeAddTemplate").change((function(){var o=this.files[0];(new FormData).append("file",o),e(".section-onlyoffice").addClass("icon-loading"),OCA.Onlyoffice.AddTemplate(o,((o,c)=>{e(".section-onlyoffice").removeClass("icon-loading");var i=c?t(OCA.Onlyoffice.AppName,"Error")+": "+c:t(OCA.Onlyoffice.AppName,"Template successfully added");c?OCP.Toast.error(i):(o&&OCA.Onlyoffice.AttachItemTemplate(o),OCP.Toast.success(i))}))})),e(document).on("click",".onlyoffice-template-delete",(function(o){var c=e(o.target).parents(".onlyoffice-template-item"),i=e(c).attr("data-id");e(".section-onlyoffice").addClass("icon-loading"),OCA.Onlyoffice.DeleteTemplate(i,(o=>{e(".section-onlyoffice").removeClass("icon-loading");var i=o.error?t(OCA.Onlyoffice.AppName,"Error")+": "+o.error:t(OCA.Onlyoffice.AppName,"Template successfully deleted");o.error?OCP.Toast.error(i):(e(c).detach(),OCP.Toast.success(i))}))})),e(document).on("click",".onlyoffice-template-item p",(function(c){var t=e(c.target).parents(".onlyoffice-template-item"),i=e(t).attr("data-id"),n=o.generateUrl("/apps/"+OCA.Onlyoffice.AppName+"/{fileId}?template={template}",{fileId:i,template:"true"});window.open(n)})),e(document).on("click",".onlyoffice-template-download",(function(c){var t=e(c.target).parents(".onlyoffice-template-item"),i=e(t).attr("data-id"),n=o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/downloadas?fileId={fileId}&template={template}",{fileId:i,template:"true"});location.href=n}))}))}(jQuery,OC);
//# sourceMappingURL=onlyoffice-settings.js.map?v=35550f8cad333ef3894c
{"version":3,"file":"onlyoffice-share.js?v=cbbc943d31673454563d","mappings":"oBA8BA,SAAWA,EAAGC,GAEVC,IAAIC,WAAaC,EAAEC,OAAO,CACtBC,QAAS,cACVJ,IAAIC,YAEPD,IAAIC,WAAWI,YAAc,CACzBC,KAAM,EACNC,OAAQ,EACRC,QAAS,EACTC,UAAW,EACXC,aAAc,GAGlB,IAAIC,EAAa,KAEbC,EAAc,IAAIZ,IAAIa,MAAMC,QAAQC,IAAI,CACxCC,GAAI,2BACJC,KAAMC,EAAElB,IAAIC,WAAWG,QAAS,YAChCe,QCjDR,8kCDmDQC,KAAAA,CAAMC,EAAIC,EAAUC,GACXZ,IACDA,EAAaa,KAGjBb,EAAWc,KAAKJ,EAAIC,EACxB,EAEAI,MAAAA,CAAOJ,GACHX,EAAWe,OAAOJ,EACtB,EAEAK,OAAAA,GACIhB,EAAWiB,OACf,EAEAC,OAAAA,CAAQP,GACJ,IAAIQ,GAAa,EAEjB,IAAKR,EAASS,cAAe,CACzB,IAAIC,EAAMhC,IAAIC,WAAWgC,iBAAiBX,EAASL,MAC/CiB,EAASlC,IAAIC,WAAWkC,QAAQC,QAAQJ,GACxCE,IAAWA,EAAe,QACvBA,EAAgB,SAChBA,EAAkB,WAClBA,EAAqB,gBACxBJ,GAAa,GAERhC,EAAE,YAAYuC,SAAS,WAAavC,EAAE,uBAAuBuC,SAAS,YACpE1B,EAAWW,UACXX,EAAWW,SAASN,IAAMM,EAASN,IACtCsB,KAAKZ,OAAOJ,GAGxB,CAEA,OAAOQ,CACX,IAGAN,EAAkB,WAClB,IAAIe,EAAM,KAENL,EAAS,KACTZ,EAAW,KACXkB,EAAa,KACbC,EAAe,KACfC,EAAkB,KAClBC,EAAe,KAEfC,EAAe,WACf,OAAOL,EAAIM,KAAK,8BACpB,EAEIC,EAAc,SAAUC,GAC+B,IAAnDR,EAAIM,KAAK,+BAA+BG,SACxClD,EAAE,OAAQ,CAACmD,MAAO,+BAA+BC,SAASX,GAC1DzC,EAAE,SAASqD,KAAKjC,EAAElB,IAAIC,WAAWG,QAAS,gEAAgEgD,UAAUb,IAGpHI,EACAI,IAIJjD,EAAEuD,IAAItD,EAAGuD,SAAStD,IAAIC,WAAWG,QAAS,YAAa,eACnD,SAAUmD,GACNZ,EAAe7C,EAAEyD,GAEjBR,GACJ,GACR,EA2CIS,EAAwB,SAAUC,GAClC,IAAIC,EAAmBhB,EAAgBiB,YACnCC,EAAUlB,EAAgBmB,cAC1BC,EAASxC,EAASN,GAClB+C,EAAQvB,EAAWK,MAAKmB,GAAQA,EAAKC,UAAYL,IAEjDM,EAAclE,IAAIC,WAAWI,YAAYC,KACzCoD,EAAiB1D,IAAIC,WAAWI,YAAYE,UAC5C2D,GAAelE,IAAIC,WAAWI,YAAYE,QAE1CmD,EAAiB1D,IAAIC,WAAWI,YAAYG,WACxC0D,EAAclE,IAAIC,WAAWI,YAAYE,SAAWP,IAAIC,WAAWI,YAAYE,SAC/E2D,EAAclE,IAAIC,WAAWI,YAAYK,eAAiBV,IAAIC,WAAWI,YAAYK,eACzFwD,GAAelE,IAAIC,WAAWI,YAAYG,SAE1CkD,EAAiB1D,IAAIC,WAAWI,YAAYI,aACxCyD,EAAclE,IAAIC,WAAWI,YAAYE,SAAWP,IAAIC,WAAWI,YAAYE,SACnF2D,GAAelE,IAAIC,WAAWI,YAAYI,WAE1CiD,EAAiB1D,IAAIC,WAAWI,YAAYK,gBACxCwD,EAAclE,IAAIC,WAAWI,YAAYG,UAAYR,IAAIC,WAAWI,YAAYG,UACpF0D,GAAelE,IAAIC,WAAWI,YAAYK,cAG9CgC,EAAgByB,OAAM,GACtBnE,IAAIC,WAAWmE,UAAUL,EAAM/C,GAAI4C,EAASE,EAAQI,GAAcH,IAC9DvB,EAAW6B,SAAQL,IACXA,EAAKC,UAAYF,EAAME,WACvBD,EAAKhD,GAAK+C,EAAM/C,GAChBgD,EAAKE,YAAcH,EAAMG,YACzBF,EAAKM,UAAYP,EAAMO,UAC3B,IAGJ,IAAIC,EAAaC,EAAwBT,GAEzCrB,EAAgB+B,QAAQF,GACxB7B,EAAgByB,OAAM,EAAM,GAEpC,EAEIO,EAAwB,SAAUjB,GAC7Bf,IACDA,EAAkBiC,KAGtB,IACIf,EADY9D,EAAE2D,EAAEmB,QAAQC,QAAQ,0BAA0B,GACtC7D,GAExB,GAAI0B,EAAgBoC,SAAU,CAC1B,IAAIC,EAAarC,EAAgBmB,cAGjC,GAFAnB,EAAgBsC,QAEZD,GAAcnB,EAAS,MAC/B,CAEA,IAAIG,EAAQvB,EAAWK,MAAKmB,GAAQA,EAAKC,UAAYL,IAEjDW,EAAaC,EAAwBT,GAEzCrB,EAAgBuC,KAAKlB,EAAME,SAAUM,EAAYzE,EAAE2D,EAAEmB,QAAQM,WACjE,EA2BIV,EAA0B,SAAUT,GACpC,IAAIQ,EAAa,GAEjB,GAAIrC,EAAe,SACXlC,IAAIC,WAAWI,YAAYE,OAASwD,EAAiB,aAAO/D,IAAIC,WAAWI,YAAYE,OAAQ,CACnG,IAAI4E,GAAUnF,IAAIC,WAAWI,YAAYE,OAASwD,EAAmB,eAAO/D,IAAIC,WAAWI,YAAYE,OACvGgE,EAAWa,KAAK,CACZC,QAASF,EACTpB,MAAO/D,IAAIC,WAAWI,YAAYE,OAClC+E,MAAOpE,EAAElB,IAAIC,WAAWG,QAAS,gBAEzC,CACA,GAAI8B,EAAgB,UACZlC,IAAIC,WAAWI,YAAYG,QAAUuD,EAAiB,aAAO/D,IAAIC,WAAWI,YAAYG,QAAS,CACrG,IAAI+E,GAAWvF,IAAIC,WAAWI,YAAYG,QAAUuD,EAAmB,eAAO/D,IAAIC,WAAWI,YAAYG,QACzG+D,EAAWa,KAAK,CACZC,QAASE,EACTxB,MAAO/D,IAAIC,WAAWI,YAAYG,QAClC8E,MAAOpE,EAAElB,IAAIC,WAAWG,QAAS,iBAEzC,CACA,GAAI8B,EAAkB,YACdlC,IAAIC,WAAWI,YAAYI,UAAYsD,EAAiB,aAAO/D,IAAIC,WAAWI,YAAYI,UAAW,CACzG,IAAI+E,GAAaxF,IAAIC,WAAWI,YAAYI,UAAYsD,EAAmB,eAAO/D,IAAIC,WAAWI,YAAYI,UAC7G8D,EAAWa,KAAK,CACZC,QAASG,EACTzB,MAAO/D,IAAIC,WAAWI,YAAYI,UAClC6E,MAAOpE,EAAElB,IAAIC,WAAWG,QAAS,iBAEzC,CAEA,GAAI8B,EAAqB,eACjBlC,IAAIC,WAAWI,YAAYK,aAAeqD,EAAiB,aAAO/D,IAAIC,WAAWI,YAAYK,aAAc,CAC/G,IAAI+E,GAAgBzF,IAAIC,WAAWI,YAAYK,aAAeqD,EAAmB,eAAO/D,IAAIC,WAAWI,YAAYK,aACnH6D,EAAWa,KAAK,CACZC,QAASI,EACT1B,MAAO/D,IAAIC,WAAWI,YAAYK,aAClC4E,MAAOpE,EAAElB,IAAIC,WAAWG,QAAS,kBAEzC,CAEA,OAAOmE,CACX,EAEII,EAAoB,WACpB,IAAIe,EAAQ5F,EAAE,QAAS,CACnBmD,MAAO,uCACR0C,OAAO7F,EAAE,QAAS,CACjBkB,IAAK,IAGL4E,EAAa,SAAUP,EAAStB,EAAO9C,GACvC,IAAI+C,EAAOlE,EAAE,QAAQ6F,OAAO7F,EAAE,SAAU,CACpCmD,MAAO,4BACR0C,OAAO7F,EAAE,UAAW,CACnBkB,GAAI,SAAW+C,EACf8B,KAAM,WACN5C,MAAO,+CACPoC,QAASA,KACTM,OAAO7F,EAAE,UAAW,CACpBgG,IAAK,SAAW/B,EAChBgC,KAAM9E,EACNgC,MAAO,6BAGCe,EAAKnB,KAAK,SAChBmD,MAAMxC,GAEZkC,EAAM7C,KAAK,MAAM8C,OAAO3B,EAC5B,EAEIiC,EAAc,WACd,IAAIC,EAAQR,EAAM7C,KAAK,MACnBqD,GACAA,EAAMC,QAEd,EAEIC,EAAc,SAAUpF,GACxB0E,EAAM7C,KAAK,MAAMwD,KAAK,KAAMrF,EAChC,EAIA,OAFAuB,EAAIoD,OAAOD,GAEJ,CACHZ,OAAQ,WACJ,OAAOY,EAAMY,GAAG,WACpB,EAEArB,KAAM,SAAUjE,EAAIuD,EAAYW,GAC5Be,IAEIf,GACAQ,EAAMa,IAAI,CAACC,IAAKtB,EAASsB,MAG7BjC,EAAWF,SAAQgC,IACfT,EAAWS,EAAKhB,QAASgB,EAAKtC,MAAOsC,EAAKf,MAAM,IAGpDc,EAAYpF,GACZ0E,EAAMe,MACV,EAEAzB,MAAO,WACHiB,IAEAG,GAAa,GACbV,EAAMgB,MACV,EAEAjC,QAAS,SAAUF,GACf0B,IAEA1B,EAAWF,SAAQgC,IACfT,EAAWS,EAAKhB,QAASgB,EAAKtC,MAAOsC,EAAKf,MAAM,GAExD,EAEAnB,MAAO,SAAUwC,GACbjB,EAAM7C,KAAK,SAAS+D,KAAK,WAAYD,EACzC,EAEAhD,UAAW,WAIP,IAHA,IAAIkD,EAAS,GAETX,EAAQR,EAAM7C,KAAK,SACdiE,EAAI,EAAGA,EAAIZ,EAAMlD,OAAQ8D,IAAK,CAEnCD,EADYX,EAAMY,GAAG9F,GAAG+F,MAAM,UAAU,IACxBb,EAAMY,GAAGzB,OAC7B,CAEA,OAAOwB,CACX,EAEAhD,YAAa,WACT,OAAO6B,EAAM7C,KAAK,MAAMwD,KAAK,KACjC,EAER,EAEA,MAAO,CACH,YAAI/E,GACA,OAAOA,CACX,EAEAG,KAAM,SAAUuF,EAAKC,GACjB1E,EAAMzC,EAAEkH,GAERlE,GAAY,KACRR,KAAKZ,OAAOuF,EAAU,GAE9B,EAEAvF,OAAQ,SAAUuF,GAnLA,IACdxF,EAmLqB,OAAjBgB,IAnLJhB,GAAO,GAoLHgB,EAlLD,CACHyE,GAAI,WACKzF,IACD3B,EAAE,YAAYoH,GAAG,SAAS,SAAUzD,GAChC,IAAImB,EAAS9E,EAAE2D,EAAEmB,QAAQ,GACpBlC,GACGA,EAAgBoC,UACJ,2BAAbF,EAAO5D,IACa,0BAApB4D,EAAOuC,YACPvC,EAAOC,QAAQ,6BAItBnC,EAAgBsC,OACpB,IAEAvD,GAAO,EAEf,IAiKiByF,MAGjBtE,IAAewE,WAAWjB,SAE1B7E,EAAW2F,EAEX,IAAIjF,EAAMhC,IAAIC,WAAWgC,iBAAiBX,EAASL,MACnDiB,EAASlC,IAAIC,WAAWkC,QAAQC,QAAQJ,GAExChC,IAAIC,WAAWoH,UAAU/F,EAASN,IAAKsG,IACnC9E,EAAa8E,EAxSrBxE,GAAY,KACRN,EAAW6B,SAAQN,IACf,IAAIwD,EAAW5E,EAAa6E,QACxBC,EAAWF,EAAS1E,KAAK,QACzB6E,EAASH,EAAS1E,KAAK,OACvB8E,EAAeJ,EAAS1E,KAAK,4BAE7B+E,EAAY,qBAAuB7D,EAAM8D,UAAY,UACrDvC,EAAQvB,EAAM+D,cACd/D,EAAM8B,MAAQ9F,EAAGgI,MAAMC,kBACpBjE,EAAM8B,MAAQ9F,EAAGgI,MAAME,kBAC1BL,EAAY,2BAA6B7D,EAAM8D,UAAY,UAC3DvC,EAAQvB,EAAM8D,UAAY,KAAO3G,EAAElB,IAAIC,WAAWG,QAAS,SAAW,KAGtE2D,EAAM8B,MAAQ9F,EAAGgI,MAAME,kBACvB3C,EAAQvB,EAAM8D,UAAY,KAAO3G,EAAElB,IAAIC,WAAWG,QAAS,gBAAkB,KAG7E2D,EAAM8B,MAAQ9F,EAAGgI,MAAMG,kBACvB5C,EAAQpE,EAAElB,IAAIC,WAAWG,QAAS,cAEdmH,EAAS1E,KAAK,cACpBsF,SAAS,gCAEvBP,EAAY,gCAGhBD,EAAa3B,MAAMtB,GAEnBgD,EAAO,GAAGU,IAAMR,EAChBH,EAAS,GAAGY,UAAY/C,EAExBiC,EAAS,GAAGvG,GAAK+C,EAAME,SAEvBrB,IAAe+C,OAAO4B,EAAS,GACjC,GAsQU,GAEhB,EAEA3F,MAAO,WACHW,EAAM,KACNL,EAAS,KACTZ,EAAW,KACXkB,EAAa,KACbE,EAAkB,IACtB,EAER,EAEA1C,IAAIC,WAAWoH,UAAY,SAASvD,EAAQf,GACxCjD,EAAEwI,KAAK,CACHC,IAAKxI,EAAGyI,UAAU,QAAUxI,IAAIC,WAAWG,QAAU,iBAAkB,GAAK0D,EAAS,eACrF2E,QAAS,SAAmBC,GACxB3F,EAAS2F,EAASC,IAAIC,KAC1B,GAER,EAEA5I,IAAIC,WAAWmE,UAAY,SAASpD,EAAI4C,EAASE,EAAQI,EAAanB,GAClE,IAAI6F,EAAO,CACPC,QAAS7H,EACT4C,QAASA,EACTE,OAAQA,EACRI,YAAaA,GAGjBpE,EAAEwI,KAAK,CACHQ,OAAQ,MACRP,IAAKxI,EAAGyI,UAAU,QAAUxI,IAAIC,WAAWG,QAAU,UAAW,GAAK,qBACrEwI,KAAMA,EACNH,QAAS,SAAmBC,GACxB3F,EAAS2F,EAASC,IAAIC,KAC1B,GAER,EAEI5I,IAAIa,MAAMC,SAAWd,IAAIa,MAAMC,QAAQiI,aACvC/I,IAAIa,MAAMC,QAAQiI,YAAYnI,EAGrC,CAtbD,CAsbGoI,OAAQjJ,G","sources":["webpack:///onlyoffice/src/share.js","webpack:///onlyoffice/img/app-dark.svg"],"sourcesContent":["/**\n *\n * (c) Copyright Ascensio System SIA 2024\n *\n * This program is a free software product.\n * You can redistribute it and/or modify it under the terms of the GNU Affero General Public License\n * (AGPL) version 3 as published by the Free Software Foundation.\n * In accordance with Section 7(a) of the GNU AGPL its Section 15 shall be amended to the effect\n * that Ascensio System SIA expressly excludes the warranty of non-infringement of any third-party rights.\n *\n * This program is distributed WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * For details, see the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html\n *\n * You can contact Ascensio System SIA at 20A-12 Ernesta Birznieka-Upisha street, Riga, Latvia, EU, LV-1050.\n *\n * The interactive user interfaces in modified source and object code versions of the Program\n * must display Appropriate Legal Notices, as required under Section 5 of the GNU AGPL version 3.\n *\n * Pursuant to Section 7(b) of the License you must retain the original Product logo when distributing the program.\n * Pursuant to Section 7(e) we decline to grant you any rights under trademark law for use of our trademarks.\n *\n * All the Product's GUI elements, including illustrations and icon sets, as well as technical\n * writing content are licensed under the terms of the Creative Commons Attribution-ShareAlike 4.0 International.\n * See the License terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode\n *\n */\n\nimport AppDarkSvg from \"!!raw-loader!../img/app-dark.svg\";\n\n(function ($, OC) {\n\n    OCA.Onlyoffice = _.extend({\n        AppName: \"onlyoffice\",\n    }, OCA.Onlyoffice);\n\n    OCA.Onlyoffice.Permissions = {\n        None: 0,\n        Review: 1,\n        Comment: 2,\n        FillForms: 4,\n        ModifyFilter: 8\n    };\n\n    var tabcontext = null;\n\n    var advancedTab = new OCA.Files.Sidebar.Tab({\n        id: \"onlyofficeSharingTabView\",\n        name: t(OCA.Onlyoffice.AppName, \"Advanced\"),\n        iconSvg: AppDarkSvg,\n\n        mount(el, fileInfo, context) {\n            if (!tabcontext) {\n                tabcontext = advancedContext();\n            }\n\n            tabcontext.init(el, fileInfo);\n        },\n\n        update(fileInfo) {\n            tabcontext.update(fileInfo);\n        },\n\n        destroy() {\n            tabcontext.clear();\n        },\n\n        enabled(fileInfo) {\n            var canDisplay = false;\n\n            if (!fileInfo.isDirectory()) {\n                var ext = OCA.Onlyoffice.getFileExtension(fileInfo.name);\n                var format = OCA.Onlyoffice.setting.formats[ext];\n                if (format && (format[\"review\"]\n                    || format[\"comment\"]\n                    || format[\"fillForms\"]\n                    || format[\"modifyFilter\"])) {\n                    canDisplay = true;\n\n                    if (($(\"#sharing\").hasClass(\"active\") || $(\"#tab-button-sharing\").hasClass(\"active\"))\n                        && tabcontext.fileInfo\n                        && tabcontext.fileInfo.id == fileInfo.id) {\n                        this.update(fileInfo);\n                    }\n                }\n            };\n\n            return canDisplay;\n        }\n    });\n\n    var advancedContext = function () {\n        var $el = null;\n\n        var format = null;\n        var fileInfo = null;\n        var collection = null;\n        var customEvents = null;\n        var permissionsMenu = null;\n        var templateItem = null;\n\n        var getContainer = function () {\n            return $el.find(\".onlyoffice-share-container\");\n        };\n\n        var getTemplate = function (callback) {\n            if ($el.find(\".onlyoffice-share-container\").length === 0) {\n                $(\"<ul>\", {class: \"onlyoffice-share-container\"}).appendTo($el)\n                $(\"<div>\").html(t(OCA.Onlyoffice.AppName, \"Provide advanced document permissions using ONLYOFFICE Docs\")).prependTo($el);\n            }\n\n            if (templateItem) {\n                callback();\n                return;\n            }\n\n            $.get(OC.filePath(OCA.Onlyoffice.AppName, \"templates\", \"share.html\"),\n                function (tmpl) {\n                    templateItem = $(tmpl);\n\n                    callback();\n                });\n        };\n\n        var render = function () {\n            getTemplate(() => {\n                collection.forEach(extra => {\n                    var itemNode = templateItem.clone();\n                    var descNode = itemNode.find(\"span\");\n                    var avatar = itemNode.find(\"img\");\n                    var actionButton = itemNode.find(\"#onlyoffice-share-action\");\n\n                    var avatarSrc = \"/index.php/avatar/\" + extra.shareWith + \"/32?v=0\";\n                    var label = extra.shareWithName;\n                    if (extra.type == OC.Share.SHARE_TYPE_GROUP\n                        || extra.type == OC.Share.SHARE_TYPE_ROOM) {\n                        avatarSrc = \"/index.php/avatar/guest/\" + extra.shareWith + \"/32?v=0\";\n                        label = extra.shareWith + \" (\" + t(OCA.Onlyoffice.AppName, \"group\") + \")\";\n                    }\n\n                    if (extra.type == OC.Share.SHARE_TYPE_ROOM) {\n                        label = extra.shareWith + \" (\" + t(OCA.Onlyoffice.AppName, \"conversation\") + \")\";\n                    }\n\n                    if (extra.type == OC.Share.SHARE_TYPE_LINK) {\n                        label = t(OCA.Onlyoffice.AppName, \"Share link\");\n\n                        var avatarWrapper = itemNode.find(\".avatardiv\");\n                        avatarWrapper.addClass(\"onlyoffice-share-link-avatar\");\n\n                        avatarSrc = \"/core/img/actions/public.svg\";\n                    }\n\n                    actionButton.click(onClickPermissionMenu);\n\n                    avatar[0].src = avatarSrc;\n                    descNode[0].innerText = label;\n\n                    itemNode[0].id = extra.share_id;\n\n                    getContainer().append(itemNode);\n                });\n            });\n        };\n\n        var onClickSetPermissions = function (e) {\n            var permissionValues = permissionsMenu.getValues();\n            var shareId = permissionsMenu.getTargetId();\n            var fileId = fileInfo.id;\n            var extra = collection.find(item => item.share_id == shareId);\n\n            var permissions = OCA.Onlyoffice.Permissions.None;\n            if (permissionValues[OCA.Onlyoffice.Permissions.Review]) {\n                permissions |= OCA.Onlyoffice.Permissions.Review;\n            }\n            if (permissionValues[OCA.Onlyoffice.Permissions.Comment]\n                && (permissions & OCA.Onlyoffice.Permissions.Review) != OCA.Onlyoffice.Permissions.Review\n                && (permissions & OCA.Onlyoffice.Permissions.ModifyFilter) != OCA.Onlyoffice.Permissions.ModifyFilter) {\n                permissions |= OCA.Onlyoffice.Permissions.Comment;\n            }\n            if (permissionValues[OCA.Onlyoffice.Permissions.FillForms]\n                && (permissions & OCA.Onlyoffice.Permissions.Review) != OCA.Onlyoffice.Permissions.Review) {\n                permissions |= OCA.Onlyoffice.Permissions.FillForms;\n            }\n            if (permissionValues[OCA.Onlyoffice.Permissions.ModifyFilter]\n                && (permissions & OCA.Onlyoffice.Permissions.Comment) != OCA.Onlyoffice.Permissions.Comment) {\n                permissions |= OCA.Onlyoffice.Permissions.ModifyFilter;\n            }\n\n            permissionsMenu.block(true);\n            OCA.Onlyoffice.SetShares(extra.id, shareId, fileId, permissions, (extra) => {\n                collection.forEach(item => {\n                    if (item.share_id == extra.share_id) {\n                        item.id = extra.id;\n                        item.permissions = extra.permissions;\n                        item.available = extra.available\n                    }\n                });\n\n                var attributes = getPermissionAttributes(extra);\n\n                permissionsMenu.refresh(attributes);\n                permissionsMenu.block(false);\n            });\n        };\n\n        var onClickPermissionMenu = function (e) {\n            if (!permissionsMenu) {\n                permissionsMenu = getPermissionMenu();\n            }\n\n            var shareNode = $(e.target).closest(\".onlyoffice-share-item\")[0];\n            var shareId = shareNode.id;\n\n            if (permissionsMenu.isOpen()) {\n                var previousId = permissionsMenu.getTargetId();\n                permissionsMenu.close();\n\n                if (previousId == shareId) return;\n            }\n\n            var extra = collection.find(item => item.share_id == shareId);\n\n            var attributes = getPermissionAttributes(extra);\n\n            permissionsMenu.open(extra.share_id, attributes, $(e.target).position());\n        };\n\n        var getCustomEvents = function () {\n            var init = false;\n\n            return {\n                on: function () {\n                    if (!init) {\n                        $(\"#content\").on(\"click\", function (e) {\n                            var target = $(e.target)[0];\n                            if (!permissionsMenu\n                                || !permissionsMenu.isOpen()\n                                || target.id == \"onlyoffice-share-action\"\n                                || target.className == \"onlyoffice-share-label\"\n                                || target.closest(\".onlyoffice-share-action\")) {\n                                return;\n                            }\n\n                            permissionsMenu.close();\n                        });\n\n                        init = true;\n                    }\n                }\n            }\n        };\n\n        var getPermissionAttributes = function (extra) {\n            var attributes = [];\n\n            if (format[\"review\"]\n                && (OCA.Onlyoffice.Permissions.Review & extra[\"available\"]) === OCA.Onlyoffice.Permissions.Review) {\n                var review = (OCA.Onlyoffice.Permissions.Review & extra[\"permissions\"]) === OCA.Onlyoffice.Permissions.Review;\n                attributes.push({\n                    checked: review,\n                    extra: OCA.Onlyoffice.Permissions.Review,\n                    label: t(OCA.Onlyoffice.AppName, \"Review only\")\n                });\n            }\n            if (format[\"comment\"]\n                && (OCA.Onlyoffice.Permissions.Comment & extra[\"available\"]) === OCA.Onlyoffice.Permissions.Comment) {\n                var comment = (OCA.Onlyoffice.Permissions.Comment & extra[\"permissions\"]) === OCA.Onlyoffice.Permissions.Comment;\n                attributes.push({\n                    checked: comment,\n                    extra: OCA.Onlyoffice.Permissions.Comment,\n                    label: t(OCA.Onlyoffice.AppName, \"Comment only\")\n                });\n            }\n            if (format[\"fillForms\"]\n                && (OCA.Onlyoffice.Permissions.FillForms & extra[\"available\"]) === OCA.Onlyoffice.Permissions.FillForms) {\n                var fillForms = (OCA.Onlyoffice.Permissions.FillForms & extra[\"permissions\"]) === OCA.Onlyoffice.Permissions.FillForms;\n                attributes.push({\n                    checked: fillForms,\n                    extra: OCA.Onlyoffice.Permissions.FillForms,\n                    label: t(OCA.Onlyoffice.AppName, \"Form filling\")\n                });\n            }\n\n            if (format[\"modifyFilter\"]\n                && (OCA.Onlyoffice.Permissions.ModifyFilter & extra[\"available\"]) === OCA.Onlyoffice.Permissions.ModifyFilter) {\n                var modifyFilter = (OCA.Onlyoffice.Permissions.ModifyFilter & extra[\"permissions\"]) === OCA.Onlyoffice.Permissions.ModifyFilter;\n                attributes.push({\n                    checked: modifyFilter,\n                    extra: OCA.Onlyoffice.Permissions.ModifyFilter,\n                    label: t(OCA.Onlyoffice.AppName, \"Global filter\")\n                });\n            }\n\n            return attributes;\n        };\n\n        var getPermissionMenu = function () {\n            var popup = $(\"<div>\", {\n                class: \"popovermenu onlyoffice-share-popup\"\n            }).append($(\"<ul>\"), {\n                id: -1\n            });\n\n            var appendItem = function (checked, extra, name) {\n                var item = $(\"<li>\").append($(\"<span>\", {\n                    class: \"onlyoffice-share-action\"\n                }).append($(\"<input>\", {\n                    id: \"extra-\" + extra,\n                    type: \"checkbox\",\n                    class: \"checkbox action-checkbox__checkbox focusable\",\n                    checked: checked\n                })).append($(\"<label>\", {\n                    for: \"extra-\" + extra,\n                    text: name,\n                    class: \"onlyoffice-share-label\"\n                })));\n\n                var input = item.find(\"input\");\n                input.click(onClickSetPermissions);\n\n                popup.find(\"ul\").append(item);\n            };\n\n            var removeItems = function () {\n                var items = popup.find(\"li\");\n                if (items) {\n                    items.remove();\n                }\n            }\n\n            var setTargetId = function (id) {\n                popup.find(\"ul\").attr(\"id\", id);\n            };\n\n            $el.append(popup);\n\n            return {\n                isOpen: function () {\n                    return popup.is(\":visible\");\n                },\n\n                open: function (id, attributes, position) {\n                    removeItems();\n\n                    if (position) {\n                        popup.css({top: position.top});\n                    }\n\n                    attributes.forEach(attr => {\n                        appendItem(attr.checked, attr.extra, attr.label);\n                    });\n\n                    setTargetId(id);\n                    popup.show();\n                },\n\n                close: function () {\n                    removeItems();\n\n                    setTargetId(-1);\n                    popup.hide();\n                },\n\n                refresh: function (attributes) {\n                    removeItems();\n\n                    attributes.forEach(attr => {\n                        appendItem(attr.checked, attr.extra, attr.label);\n                    });\n                },\n\n                block: function (value) {\n                    popup.find(\"input\").prop(\"disabled\", value);\n                },\n\n                getValues: function () {\n                    var values = [];\n\n                    var items = popup.find(\"input\");\n                    for (var i = 0; i < items.length; i++) {\n                        var extra = items[i].id.split(\"extra-\")[1];\n                        values[extra] = items[i].checked;\n                    }\n\n                    return values;\n                },\n\n                getTargetId: function () {\n                    return popup.find(\"ul\").attr(\"id\");\n                }\n            }\n        };\n\n        return {\n            get fileInfo () {\n                return fileInfo;\n            },\n\n            init: function (_el, _fileInfo) {\n                $el = $(_el);\n\n                getTemplate(() => {\n                    this.update(_fileInfo);\n                });\n            },\n\n            update: function (_fileInfo) {\n                if (customEvents === null) {\n                    customEvents = getCustomEvents();\n                    customEvents.on();\n                }\n\n                getContainer().children().remove();\n\n                fileInfo = _fileInfo;\n\n                var ext = OCA.Onlyoffice.getFileExtension(fileInfo.name);\n                format = OCA.Onlyoffice.setting.formats[ext];\n\n                OCA.Onlyoffice.GetShares(fileInfo.id, (shares) => {\n                    collection = shares;\n\n                    render();\n                });\n            },\n\n            clear: function () {\n                $el = null;\n                format = null;\n                fileInfo = null;\n                collection = null;\n                permissionsMenu = null;\n            }\n        };\n    };\n\n    OCA.Onlyoffice.GetShares = function(fileId, callback) {\n        $.ajax({\n            url: OC.linkToOCS(\"apps/\" + OCA.Onlyoffice.AppName + \"/api/v1/shares\", 2) + fileId + \"?format=json\",\n            success: function onSuccess(response) {\n                callback(response.ocs.data);\n            }\n        })\n    };\n\n    OCA.Onlyoffice.SetShares = function(id, shareId, fileId, permissions, callback) {\n        var data = {\n            extraId: id,\n            shareId: shareId,\n            fileId: fileId,\n            permissions: permissions\n        }\n\n        $.ajax({\n            method: \"PUT\",\n            url: OC.linkToOCS(\"apps/\" + OCA.Onlyoffice.AppName + \"/api/v1\", 2) + \"shares?format=json\",\n            data: data,\n            success: function onSuccess(response) {\n                callback(response.ocs.data);\n            }\n        })\n    };\n\n    if (OCA.Files.Sidebar && OCA.Files.Sidebar.registerTab) {\n        OCA.Files.Sidebar.registerTab(advancedTab);\n    }\n\n})(jQuery, OC);","export default \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\\n<svg version=\\\"1.1\\\" id=\\\"Layer_1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" x=\\\"0px\\\" y=\\\"0px\\\"\\n\\t viewBox=\\\"0 0 16 16\\\" style=\\\"enable-background:new 0 0 16 16;\\\" xml:space=\\\"preserve\\\">\\n<style type=\\\"text/css\\\">\\n\\t.st0{opacity:0.42;enable-background:new    ;}\\n\\t.st1{opacity:0.72;enable-background:new    ;}\\n</style>\\n<g id=\\\"XMLID_5_\\\">\\n\\t<path id=\\\"XMLID_3_\\\" class=\\\"st0\\\" d=\\\"M6.9,15.2l-6.4-3.1c-0.6-0.2-0.6-0.7,0-0.9l2.2-1.1l4.2,2c0.6,0.2,1.4,0.2,2,0l4.2-2l2.2,1.1\\n\\t\\tc0.6,0.2,0.6,0.7,0,0.9L9,15.2C8.4,15.4,7.5,15.4,6.9,15.2L6.9,15.2z\\\"/>\\n\\t<path id=\\\"XMLID_2_\\\" class=\\\"st1\\\" d=\\\"M6.9,11.5L0.5,8.5c-0.6-0.2-0.6-0.7,0-0.9l2.2-1.1l4.2,2c0.6,0.2,1.4,0.2,2,0l4.3-2l2.2,1\\n\\t\\tc0.6,0.2,0.6,0.7,0,0.9L9,11.4C8.4,11.8,7.5,11.8,6.9,11.5L6.9,11.5z\\\"/>\\n\\t<path id=\\\"XMLID_1_\\\" d=\\\"M6.9,7.9L0.5,4.8c-0.6-0.2-0.6-0.7,0-0.9l6.4-3.1c0.6-0.2,1.4-0.2,2,0l6.4,3.1c0.6,0.2,0.6,0.7,0,0.9\\n\\t\\tL8.9,7.9C8.4,8.1,7.5,8.1,6.9,7.9L6.9,7.9z\\\"/>\\n</g>\\n</svg>\\n\";"],"names":["$","OC","OCA","Onlyoffice","_","extend","AppName","Permissions","None","Review","Comment","FillForms","ModifyFilter","tabcontext","advancedTab","Files","Sidebar","Tab","id","name","t","iconSvg","mount","el","fileInfo","context","advancedContext","init","update","destroy","clear","enabled","canDisplay","isDirectory","ext","getFileExtension","format","setting","formats","hasClass","this","$el","collection","customEvents","permissionsMenu","templateItem","getContainer","find","getTemplate","callback","length","class","appendTo","html","prependTo","get","filePath","tmpl","onClickSetPermissions","e","permissionValues","getValues","shareId","getTargetId","fileId","extra","item","share_id","permissions","block","SetShares","forEach","available","attributes","getPermissionAttributes","refresh","onClickPermissionMenu","getPermissionMenu","target","closest","isOpen","previousId","close","open","position","review","push","checked","label","comment","fillForms","modifyFilter","popup","append","appendItem","type","for","text","click","removeItems","items","remove","setTargetId","attr","is","css","top","show","hide","value","prop","values","i","split","_el","_fileInfo","on","className","children","GetShares","shares","itemNode","clone","descNode","avatar","actionButton","avatarSrc","shareWith","shareWithName","Share","SHARE_TYPE_GROUP","SHARE_TYPE_ROOM","SHARE_TYPE_LINK","addClass","src","innerText","ajax","url","linkToOCS","success","response","ocs","data","extraId","method","registerTab","jQuery"],"sourceRoot":""}